#!/bin/bash

TESTNET_CHANNEL=$(terraform workspace show)


mkdir -p workspace/${TESTNET_CHANNEL}/logs
cat workspace/${TESTNET_CHANNEL}/ip-list | while read line; do
  ip=$(echo $line | awk '{print $2}')
  name=$(echo $line | awk '{print $1}')
  mkdir -p workspace/${TESTNET_CHANNEL}/logs/${name}___${ip}
  rsync -rz root@${ip}:~/logs/safenode.log workspace/${TESTNET_CHANNEL}/logs/${name}___${ip}/safenode__latest.log &
done
wait

echo "Logs updating..."